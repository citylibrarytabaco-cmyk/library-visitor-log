<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Library Visitor Logbook 2026</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f4f4f4;
}
header {
    background: #2c3e50;
    color: white;
    text-align: center;
    padding: 15px;
}
.container {
    max-width: 1100px;
    margin: 20px auto;
    padding: 15px;
}
form, .admin-panel {
    background: white;
    padding: 20px;
    border-radius: 8px;
}
label {
    font-weight: bold;
    display: block;
    margin-top: 10px;
}
input, select, textarea {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
}
button {
    margin-top: 15px;
    padding: 10px;
    background: #2c3e50;
    color: white;
    border: none;
    cursor: pointer;
}
button:hover { background: #1a252f; }

.counter-box {
    background: #27ae60;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 18px;
    border-radius: 6px;
    margin-bottom: 15px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
th, td {
    border: 1px solid #ccc;
    padding: 6px;
}
th { background: #2c3e50; color: white; }

.hidden { display: none; }

.stat-box {
    background: #ecf0f1;
    padding: 10px;
    margin-top: 10px;
    border-radius: 6px;
}
</style>
</head>

<body>

<header>
    <h1>Library Visitor Logbook 2026</h1>
</header>

<div class="container">

<!-- DAILY COUNTER -->
<div class="counter-box">
    Today's Visitors: <span id="dailyCount">0</span>
</div>

<!-- VISITOR FORM -->
<form id="visitorForm">
    <h2>Visitor Sign-In</h2>

    <label>Last Name *</label>
    <input type="text" id="lastName" required>

    <label>First Name *</label>
    <input type="text" id="firstName" required>

    <label>Middle Name *</label>
    <input type="text" id="middleName" required>

    <label>Sex *</label>
    <select id="sex" required>
        <option value="">Select...</option>
        <option>Male</option>
        <option>Female</option>
    </select>

    <label>Age *</label>
    <input type="number" id="age" required>

    <label>City/Municipality *</label>
    <input type="text" id="city" required>

    <label>Sector *</label>
    <select id="sector" required>
        <option value="">Select...</option>
        <option>Children</option>
        <option>High School</option>
        <option>College</option>
        <option>Professional</option>
        <option>Elderly</option>
    </select>

    <label>School / Office *</label>
    <input type="text" id="school" required>

    <label>Resources to Use *</label>
    <textarea id="resources" required></textarea>

    <button type="submit">Submit</button>
</form>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="admin-panel hidden">
    <h2>Admin Dashboard</h2>

    <button onclick="exportCSV()">Export CSV</button>

    <div class="stat-box">
        <strong>Total Visitors (All Time):</strong> <span id="totalVisitors"></span>
    </div>

    <div class="stat-box">
        <strong>Male Visitors:</strong> <span id="maleCount"></span><br>
        <strong>Female Visitors:</strong> <span id="femaleCount"></span>
    </div>

    <div class="stat-box">
        <strong>Visitors by Sector:</strong>
        <div id="sectorStats"></div>
    </div>

    <table id="visitorTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Sex</th>
                <th>Age</th>
                <th>City</th>
                <th>Sector</th>
                <th>School</th>
                <th>Resources</th>
                <th>Date</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

</div>

<script>

const ADMIN_PASSWORD = "admin123";

// DAILY RESET CHECK
function checkDailyReset() {
    const today = new Date().toLocaleDateString();
    const lastDate = localStorage.getItem("lastVisitDate");

    if (lastDate !== today) {
        localStorage.setItem("dailyCount", 0);
        localStorage.setItem("lastVisitDate", today);
    }

    document.getElementById("dailyCount").innerText =
        localStorage.getItem("dailyCount") || 0;
}

// SAVE VISITOR
document.getElementById("visitorForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const now = new Date();
    const record = {
        id: Date.now(),
        name: document.getElementById("lastName").value + ", " +
              document.getElementById("firstName").value + " " +
              document.getElementById("middleName").value,
        sex: document.getElementById("sex").value,
        age: document.getElementById("age").value,
        city: document.getElementById("city").value,
        sector: document.getElementById("sector").value,
        school: document.getElementById("school").value,
        resources: document.getElementById("resources").value,
        date: now.toLocaleDateString(),
        time: now.toLocaleTimeString()
    };

    let records = JSON.parse(localStorage.getItem("visitors")) || [];
    records.push(record);
    localStorage.setItem("visitors", JSON.stringify(records));

    // update daily counter
    let count = parseInt(localStorage.getItem("dailyCount")) || 0;
    count++;
    localStorage.setItem("dailyCount", count);

    this.reset();
    checkDailyReset();
});

// ADMIN ACCESS (#admin)
if (window.location.hash === "#admin") {
    const pass = prompt("Enter Admin Password:");
    if (pass === ADMIN_PASSWORD) {
        document.getElementById("adminPanel").classList.remove("hidden");
        loadAdminData();
    } else {
        alert("Wrong password.");
    }
}

// LOAD ADMIN DATA
function loadAdminData() {
    const records = JSON.parse(localStorage.getItem("visitors")) || [];
    const tbody = document.querySelector("#visitorTable tbody");
    tbody.innerHTML = "";

    let male = 0;
    let female = 0;
    let sectorCounts = {};

    records.forEach(r => {
        if (r.sex === "Male") male++;
        if (r.sex === "Female") female++;

        sectorCounts[r.sector] = (sectorCounts[r.sector] || 0) + 1;

        const row = `<tr>
            <td>${r.name}</td>
            <td>${r.sex}</td>
            <td>${r.age}</td>
            <td>${r.city}</td>
            <td>${r.sector}</td>
            <td>${r.school}</td>
            <td>${r.resources}</td>
            <td>${r.date}</td>
            <td>${r.time}</td>
        </tr>`;
        tbody
