<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Library Logbook 2026</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 0;
}
header {
    background: #3e5998;
    color: white;
    text-align: center;
    padding: 15px;
}
.container {
    margin: 20px auto;
    max-width: 1000px;
}
form {
    background: white;
    padding: 20px;
    border-radius: 8px;
}
label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
}
input, select, textarea {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
}
button {
    padding: 10px;
    margin-top: 15px;
    background: #3e5998;
    color: white;
    border: none;
    cursor: pointer;
}
button:hover { background: #2d4070; }
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}
th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
}
th { background: #3e5998; color: white; }
</style>

</head>
<body>

<header>
    <h1>Library Visitor Logbook 2026</h1>
</header>

<div class="container">

<!-- FORM -->
<form id="visitorForm">
    <h2>Visitor Sign-In</h2>

    <label>Last Name *</label>
    <input type="text" id="lastName" required>

    <label>First Name *</label>
    <input type="text" id="firstName" required>

    <label>Middle Name *</label>
    <input type="text" id="middleName" required>

    <label>Sex *</label>
    <select id="sex" required>
        <option value="">Select...</option>
        <option>Male</option>
        <option>Female</option>
    </select>

    <label>Age *</label>
    <input type="number" id="age" required>

    <label>Brgy / City or Municipality *</label>
    <input type="text" id="brgyCity" required>

    <label>Barangay *</label>
    <input type="text" id="barangay" required>

    <label>City/Municipality *</label>
    <select id="cityMunicipality" required>
        <option value="">Select...</option>
        <option>Tabaco City</option>
        <option>Bacacay</option>
        <option>Malinao</option>
        <option>Sto. Domingo</option>
        <option>Malilipot</option>
        <option>Tiwi</option>
        <option>Ligao</option>
        <option>Legazpi</option>
    </select>

    <label>Province *</label>
    <input type="text" id="province" value="Albay" required>

    <label>Sector / Groups *</label>
    <select id="sector" required>
        <option value="">Select...</option>
        <option>Children</option>
        <option>Elementary</option>
        <option>High School</option>
        <option>College</option>
        <option>Graduate School</option>
        <option>Professionals</option>
        <option>Out of School Youth</option>
        <option>Elderly</option>
        <option>City Personnel</option>
        <option>Other</option>
    </select>

    <label>Name of School / Office / Agency *</label>
    <input type="text" id="schoolOffice" required>

    <label>What resources are you going to use? *</label>
    <textarea id="resources" placeholder="e.g. COMPUTER USE / INTERNET, TEXTBOOKS" required></textarea>

    <button type="submit">Submit</button>
</form>

<!-- CONTROLS -->
<div style="margin-top: 20px;">
    <input type="text" id="search" placeholder="Search records...">
    <button onclick="exportCSV()">Export CSV</button>
    <button onclick="clearRecords()">Clear All</button>
</div>

<!-- TABLE -->
<table id="visitorTable">
    <thead>
        <tr>
            <th>Name</th><th>Sex</th><th>Age</th><th>Address</th>
            <th>Sector</th><th>School/Office</th><th>Resources</th>
            <th>Date</th><th>Time In</th><th>Time Out</th><th>Action</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

</div>

<script>
// SAVE & LOAD
document.getElementById("visitorForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const now = new Date();
    const record = {
        id: Date.now(),
        lastName: document.getElementById("lastName").value.trim(),
        firstName: document.getElementById("firstName").value.trim(),
        middleName: document.getElementById("middleName").value.trim(),
        sex: document.getElementById("sex").value,
        age: document.getElementById("age").value,
        brgyCity: document.getElementById("brgyCity").value,
        barangay: document.getElementById("barangay").value,
        cityMunicipality: document.getElementById("cityMunicipality").value,
        province: document.getElementById("province").value,
        sector: document.getElementById("sector").value,
        schoolOffice: document.getElementById("schoolOffice").value,
        resources: document.getElementById("resources").value,
        date: now.toLocaleDateString(),
        timeIn: now.toLocaleTimeString(),
        timeOut: ""
    };
    let records = JSON.parse(localStorage.getItem("visitors")) || [];
    records.push(record);
    localStorage.setItem("visitors", JSON.stringify(records));
    loadRecords();
    this.reset();
});

function loadRecords() {
    const tbody = document.querySelector("#visitorTable tbody");
    tbody.innerHTML = "";
    const records = JSON.parse(localStorage.getItem("visitors")) || [];
    records.forEach(r => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${r.lastName}, ${r.firstName} ${r.middleName}</td>
            <td>${r.sex}</td><td>${r.age}</td>
            <td>${r.brgyCity}, ${r.barangay}, ${r.cityMunicipality}, ${r.province}</td>
            <td>${r.sector}</td><td>${r.schoolOffice}</td>
            <td>${r.resources}</td><td>${r.date}</td>
            <td>${r.timeIn}</td><td>${r.timeOut || "-"}</td>
            <td><button onclick="timeOut(${r.id})">Time Out</button></td>`;
        tbody.appendChild(row);
    });
}

// TIME OUT
function timeOut(id) {
    let records = JSON.parse(localStorage.getItem("visitors")) || [];
    records = records.map(r => {
        if (r.id === id && !r.timeOut) r.timeOut = new Date().toLocaleTimeString();
        return r;
    });
    localStorage.setItem("visitors", JSON.stringify(records));
    loadRecords();
}

// SEARCH
document.getElementById("search").addEventListener("input", function() {
    const text = this.value.toLowerCase();
    document.querySelectorAll("#visitorTable tbody tr").forEach(row => {
        row.style.display = row.textContent.toLowerCase().includes(text) ? "" : "none";
    });
});

// EXPORT CSV
function exportCSV() {
    const records = JSON.parse(localStorage.getItem("visitors")) || [];
    let csv = "Name,Sex,Age,Address,Sector,SchoolOffice,Resources,Date,TimeIn,TimeOut\n";
    records.forEach(r => {
        csv += `"${r.lastName}, ${r.firstName}","${r.sex}",${r.age},"${r.brgyCity} ${r.barangay} ${r.cityMunicipality}","${r.sector}","${r.schoolOffice}","${r.resources}",${r.date},${r.timeIn},${r.timeOut}\n`;
    });
    const blob = new Blob([csv], { type: "text/csv" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "library_log.csv";
    link.click();
}

// CLEAR DATA
function clearRecords() {
    if (confirm("Delete all records?")) {
        localStorage.removeItem("visitors");
        loadRecords();
    }
}

window.onload = loadRecords;

</script>

</body>
</html>
