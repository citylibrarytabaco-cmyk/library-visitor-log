<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Library Visitor Log System</title>

<!-- =======================
     INTERNAL CSS STYLING
======================= -->
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: #f4f1ea;
    }

    header {
        background: #5b4636;
        color: white;
        padding: 15px;
        text-align: center;
    }

    h1 {
        margin: 0;
    }

    .container {
        padding: 20px;
        max-width: 1000px;
        margin: auto;
    }

    form {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }

    label {
        font-weight: bold;
        display: block;
        margin-top: 10px;
    }

    input, textarea, button {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
        box-sizing: border-box;
    }

    button {
        background: #5b4636;
        color: white;
        cursor: pointer;
        margin-top: 15px;
    }

    button:hover {
        background: #3e3227;
    }

    .controls {
        margin-bottom: 15px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }

    th {
        background: #5b4636;
        color: white;
    }

    @media (max-width: 768px) {
        table, thead, tbody, th, td, tr {
            display: block;
        }
        th {
            display: none;
        }
        td {
            border: none;
            border-bottom: 1px solid #ddd;
        }
    }
</style>
</head>

<body>

<header>
    <h1>Library Visitor Log System</h1>
</header>

<div class="container">

    <!-- =======================
         VISITOR SIGN-IN FORM
    ======================= -->
    <form id="visitorForm">
        <h2>Visitor Sign-In</h2>

        <label>Full Name *</label>
        <input type="text" id="fullName" required>

        <label>Phone Number *</label>
        <input type="text" id="phone" required>

        <label>Email</label>
        <input type="email" id="email">

        <label>Purpose of Visit *</label>
        <textarea id="purpose" required></textarea>

        <label>Signature (Type Full Name) *</label>
        <input type="text" id="signature" required>

        <button type="submit">Submit</button>
    </form>

    <!-- =======================
         SEARCH + ACTION BUTTONS
    ======================= -->
    <div class="controls">
        <input type="text" id="search" placeholder="Search visitors...">
        <button onclick="exportCSV()">Export to CSV</button>
        <button onclick="clearRecords()">Clear All Records</button>
        <button onclick="adminLogin()">Admin Access</button>
    </div>

    <!-- =======================
         VISITOR TABLE
    ======================= -->
    <table id="visitorTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Purpose</th>
                <th>Date</th>
                <th>Time In</th>
                <th>Time Out</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

</div>

<!-- =======================
     INTERNAL JAVASCRIPT
======================= -->
<script>

let adminAuthenticated = false;
const ADMIN_PASSWORD = "library123"; // Change this password

// Load records when page loads
document.addEventListener("DOMContentLoaded", loadRecords);

// Handle form submission
document.getElementById("visitorForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const fullName = document.getElementById("fullName").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const email = document.getElementById("email").value.trim();
    const purpose = document.getElementById("purpose").value.trim();
    const signature = document.getElementById("signature").value.trim();

    if (signature !== fullName) {
        alert("Signature must match full name.");
        return;
    }

    const now = new Date();
    const record = {
        id: Date.now(),
        fullName,
        phone,
        email,
        purpose,
        date: now.toLocaleDateString(),
        timeIn: now.toLocaleTimeString(),
        timeOut: ""
    };

    let records = JSON.parse(localStorage.getItem("visitors")) || [];
    records.push(record);
    localStorage.setItem("visitors", JSON.stringify(records));

    document.getElementById("visitorForm").reset();
    loadRecords();
});

// Load records into table
function loadRecords() {
    const tbody = document.querySelector("#visitorTable tbody");
    tbody.innerHTML = "";
    const records = JSON.parse(localStorage.getItem("visitors")) || [];

    records.forEach(record => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${record.fullName}</td>
            <td>${record.phone}</td>
            <td>${record.email}</td>
            <td>${record.purpose}</td>
            <td>${record.date}</td>
            <td>${record.timeIn}</td>
            <td>${record.timeOut || "-"}</td>
            <td><button onclick="timeOut(${record.id})">Time Out</button></td>
        `;
        tbody.appendChild(row);
    });
}

// Time Out function
function timeOut(id) {
    let records = JSON.parse(localStorage.getItem("visitors")) || [];
    records = records.map(r => {
        if (r.id === id && !r.timeOut) {
            r.timeOut = new Date().toLocaleTimeString();
        }
        return r;
    });
    localStorage.setItem("visitors", JSON.stringify(records));
    loadRecords();
}

// Search functionality
document.getElementById("search").addEventListener("input", function() {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll("#visitorTable tbody tr");

    rows.forEach(row => {
        row.style.display = row.innerText.toLowerCase().includes(filter) ? "" : "none";
    });
});

// Export CSV
function exportCSV() {
    const records = JSON.parse(localStorage.getItem("visitors")) || [];
    if (records.length === 0) return alert("No records to export.");

    let csv = "Full Name,Phone,Email,Purpose,Date,Time In,Time Out\n";
    records.forEach(r => {
        csv += `${r.fullName},${r.phone},${r.email},${r.purpose},${r.date},${r.timeIn},${r.timeOut}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "visitor_log.csv";
    link.click();
}

// Clear records (Admin only)
function clearRecords() {
    if (!adminAuthenticated) {
        alert("Admin access required.");
        return;
    }

    if (confirm("Are you sure you want to delete ALL records?")) {
        localStorage.removeItem("visitors");
        loadRecords();
    }
}

// Admin Login
function adminLogin() {
    const password = prompt("Enter Admin Password:");
    if (password === ADMIN_PASSWORD) {
        adminAuthenticated = true;
        alert("Admin access granted.");
    } else {
        alert("Incorrect password.");
    }
}

</script>

</body>
</html>
